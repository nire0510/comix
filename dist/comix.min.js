(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.comix=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports={mixpanel_init:["cookie_expiration","cross_subdomain_cookie","disable_persistence","persistence","persistence_name","secure_cookie","track_links_timeout","upgrade"],defaults:{tokens:{mp:"",ga:""},bubbling_threshold:0,additional_properties:{},attribute:"data-comix",track_pageview:false,track_links:false,track_forms:false,track_custom:false},dictionary:{trackEventName:"Track",trackEventFailed:"Comix track miss",missingToken:"Mixpanel or Google Analytics tokens are required",missingEventName:"(Event Missing)",pageNamePropertyName:"Page Name",pageURLPropertyName:"Page URL",pageViewedEventName:"Page Viewed"}}},{}],2:[function(require,module,exports){module.exports={findParentNode:function findParentNode(elmTarget,strNodeName){while(elmTarget.parentNode.nodeName!==strNodeName){elmTarget=elmTarget.parentNode}return elmTarget.parentNode},extend:function extend(defaults,options){var objExtended={},objProperty;for(objProperty in defaults){if(Object.prototype.hasOwnProperty.call(defaults,objProperty)){objExtended[objProperty]=defaults[objProperty]}}for(objProperty in options){if(Object.prototype.hasOwnProperty.call(options,objProperty)){objExtended[objProperty]=options[objProperty]}}return objExtended}}},{}],3:[function(require,module,exports){(function(process){var config=require("./config.js"),decode=require("querystring").decode,helpers=require("./helpers.js"),mp=require("./providers/mp/mp.js"),ga=require("./providers/ga/ga.js"),objSettings=config.defaults,providers=[];module.exports={init:init,track:trackEvent,trackEvent:trackEvent,trackCharge:trackCharge,disableEvents:disableEvents,registerEventsProperties:registerEventsProperties,unregisterEventsProperties:unregisterEventsProperties,identifyUser:identifyUser,registerUserProperties:registerUserProperties};function init(objParams){var objInitProperties={};for(var key in objSettings){if(objSettings.hasOwnProperty(key)&&objParams.hasOwnProperty(key)){objSettings[key]=objParams[key]}}Object.keys(objSettings.tokens).forEach(function initProperties(strProviderName){var objProvider=eval(strProviderName);if(typeof objProvider==="object"){providers.push({name:strProviderName,token:objSettings.tokens[strProviderName],obj:objProvider})}else{console.warn("Unknown provider: %s",strProviderName)}});if(providers.length===0){throw new Error(config.dictionary.missingToken)}config.mixpanel_init.forEach(function initProperties(key){if(objSettings.hasOwnProperty(key)){objInitProperties[key]=objSettings[key]}});objInitProperties.track_pageview=false;objInitProperties.loaded=_ready;_init(objInitProperties)}function _ready(){Element.prototype.matches=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector;if(process.browser){registerEventsProperties(helpers.extend(decode(document.location.search&&document.location.search.substr(1))||{},objSettings.additional_properties))}if(objSettings.track_pageview){_trackPageView()}if(objSettings.track_links){_trackLinks()}if(objSettings.track_forms){_trackForms()}if(objSettings.track_custom&&Object.prototype.toString.call(objSettings.track_custom)==="[object Array]"&&objSettings.track_custom.length>0){_trackCustomEvents()}}function _init(objInitProperties){providers.forEach(function _init(provider){if(typeof provider.obj.init==="function"){provider.obj.init(provider.token,objInitProperties)}})}function trackEvent(strEventName,objProperties,fncCallback){providers.forEach(function _trackEvent(provider){if(typeof provider.obj.trackEvent==="function"){provider.obj.trackEvent(strEventName,helpers.extend({},objProperties),fncCallback)}})}function trackCharge(fltAmount,objProperties,fncCallback){providers.forEach(function _trackCharge(provider){if(typeof provider.obj.trackCharge==="function"){provider.obj.trackCharge(fltAmount,objProperties,fncCallback)}})}function _trackPageView(){providers.forEach(function _trackCharge(provider){if(typeof provider.obj.trackPageView==="function"){provider.obj.trackPageView()}})}function _trackLinks(){[].forEach.call(document.querySelectorAll("a[href][id]["+objSettings.attribute+"]"),function each(element){providers.forEach(function _trackCharge(provider){if(typeof provider.obj.trackLink==="function"){provider.obj.trackLink("#"+element.id,element.getAttribute(objSettings.attribute))}})})}function _trackForms(){[].forEach.call(document.querySelectorAll("form[id]["+objSettings.attribute+"]"),function each(element){providers.forEach(function _trackCharge(provider){if(typeof provider.obj.trackForm==="function"){provider.obj.trackForm("#"+element.id,element.getAttribute(objSettings.attribute))}})})}function _trackCustomEvents(){var arrRegisteredEvents=[];objSettings.track_custom.forEach(function loop(item){if(arrRegisteredEvents.indexOf(item.selector+item.event)===-1){arrRegisteredEvents.push(item.selector+item.event);document.addEventListener(item.event,function onEvent(e){var element=e.target,strEventName="",objEventProperties={},intAncestorLevel=0;while(element.matches(item.selector)===false&&intAncestorLevel<objSettings.bubbling_threshold){if(element.parentElement){element=element.parentElement}intAncestorLevel++}if(element.matches(item.selector)===true){if(element.tagName==="A"||element.getAttribute("type")==="submit"){e.preventDefault()}try{switch(item.name.type){case"attribute":if(element.hasAttribute(item.name.value)===true){strEventName=element.getAttribute(item.name.value)}break;case"function":if(item.name.value&&typeof item.name.value==="function"){strEventName=item.name.value(element)}break;case"text":if(item.name.value){strEventName=item.name.value}break}if("properties"in item){switch(item.properties.type){case"attribute":if(element.hasAttribute(item.properties.value)===true){objEventProperties=JSON.parse(element.getAttribute(item.properties.value))}break;case"function":if(item.properties.value&&typeof item.properties.value==="function"){objEventProperties=item.properties.value(element)}break;case"text":if(item.properties.value){objEventProperties=JSON.parse(item.properties.value)}break}}if(strEventName){providers.forEach(function _trackEvent(provider){if(typeof provider.obj.trackEvent==="function"){provider.obj.trackEvent(strEventName,{},function onEvent(){if(element.tagName==="A"){var strHref=element.getAttribute("href"),strTarget=element.getAttribute("target");strHref&&strHref.length>0&&(strTarget?window.open(strHref,strTarget):document.location.href=strHref)}else if(element.getAttribute("type")==="submit"){return true}})}})}}catch(e){console.warn(config.dictionary.trackEventFailed)}}},false)}})}function disableEvents(arrEventNames){providers.forEach(function _disableEvents(provider){if(typeof provider.obj.disableEvents==="function"){provider.obj.disableEvents(arrEventNames)}})}function registerEventsProperties(objProperties,intDays){providers.forEach(function _registerEventsProperties(provider){if(typeof provider.obj.registerEventsProperties==="function"){provider.obj.registerEventsProperties(objProperties,intDays)}})}function unregisterEventsProperties(strProperty){providers.forEach(function _unregisterEventsProperties(provider){if(typeof provider.obj.unregisterEventsProperties==="function"){provider.obj.unregisterEventsProperties(strProperty)}})}function identifyUser(strIdentity){providers.forEach(function _identifyUser(provider){if(typeof provider.obj.identifyUser==="function"){provider.obj.identifyUser(strIdentity)}})}function registerUserProperties(varProperty,varValue,fncCallback){providers.forEach(function _registerUserProperties(provider){if(typeof provider.obj.registerUserProperties==="function"){provider.obj.registerUserProperties(varProperty,varValue,fncCallback)}})}}).call(this,require("_process"))},{"./config.js":1,"./helpers.js":2,"./providers/ga/ga.js":6,"./providers/mp/mp.js":9,_process:10,querystring:13}],4:[function(require,module,exports){module.exports={identifyUser:identifyUser,registerUserProperties:registerUserProperties};function identifyUser(strIdentity){ga("comixTracker.set","userId",strIdentity)}function registerUserProperties(varProperty,varValue,fncCallback){}},{}],5:[function(require,module,exports){(function(process){var arrDisabledEvents=[],objCustomVariablesDictionary={Param1:"dimension1"};function renameProperty(obj,strOldName,strNewName){if(strOldName==strNewName){return obj}if(obj.hasOwnProperty(strOldName)){obj[strNewName]=strNewName.indexOf("dimension")===0?obj[strOldName]&&obj[strOldName].toString():obj[strOldName];delete obj[strOldName]}return obj}module.exports={disableEvents:disableEvents,trackEvent:trackEvent,trackPageView:trackPageView,trackLink:trackLink,trackForm:trackForm,trackCharge:trackCharge,registerEventsProperties:registerEventsProperties,unregisterEventsProperties:unregisterEventsProperties};function disableEvents(arrEventNames){arrDisabledEvents=arrEventNames?arrEventNames:["All"]}function trackEvent(strEventName,objProperties){var objLabel=null;if(typeof objProperties==="object"){if(Object.keys(objProperties).length===1){objLabel=objProperties[Object.keys(objProperties)[0]]&&objProperties[Object.keys(objProperties)[0]].toString()}else if(Object.keys(objProperties).length>1){Object.keys(objCustomVariablesDictionary).forEach(function _rename(strKey){renameProperty(objProperties,strKey,objCustomVariablesDictionary[strKey])});objLabel=objProperties}}if(!(arrDisabledEvents.indexOf(strEventName)>=0||arrDisabledEvents[0]==="All")){ga("comixTracker.send","event",strEventName,strEventName,objLabel)}}function trackPageView(){if(process.browser){ga("comixTracker.send","pageview",{page:document.location.pathname,title:document.title})}}function trackLink(strSelector,strEventName,objProperties){}function trackForm(strSelector,strEventName,objProperties){}function trackCharge(fltAmount,objProperties,fncCallback){}function registerEventsProperties(objProperties){Object.keys(objCustomVariablesDictionary).forEach(function _rename(strKey){renameProperty(objProperties,strKey,objCustomVariablesDictionary[strKey])});ga("comixTracker.set",objProperties)}function unregisterEventsProperties(strProperty){}}).call(this,require("_process"))},{_process:10}],6:[function(require,module,exports){var gaTracking=require("./ga-tracking"),gaPeople=require("./ga-people");module.exports={init:init,track:gaTracking.trackEvent,trackEvent:gaTracking.trackEvent,trackPageView:gaTracking.trackPageView,disableEvents:gaTracking.disableEvents,registerEventsProperties:gaTracking.registerEventsProperties,identifyUser:gaPeople.identifyUser};function init(strWebProperyId,objInitProperties){(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create",strWebProperyId,"auto",{name:"comixTracker"})}},{"./ga-people":4,"./ga-tracking":5}],7:[function(require,module,exports){module.exports={identifyUser:identifyUser,registerUserProperties:registerUserProperties};function identifyUser(strIdentity){mixpanel.identify(strIdentity)}function registerUserProperties(varProperty,varValue,fncCallback){mixpanel.people.set(varProperty,varValue,fncCallback)}},{}],8:[function(require,module,exports){(function(process){var config=require("../../config.js");module.exports={disableEvents:disableEvents,trackEvent:trackEvent,trackPageView:trackPageView,trackLink:trackLink,trackForm:trackForm,trackCharge:trackCharge,registerEventsProperties:registerEventsProperties,unregisterEventsProperties:unregisterEventsProperties};function disableEvents(arrEventNames){mixpanel.disable(arrEventNames)}function trackEvent(strEventName,objProperties,fncCallback){mixpanel.track(strEventName||config.dictionary.missingEventName,objProperties||{},fncCallback)}function trackPageView(objProperties){if(process.browser){objProperties=objProperties||{};objProperties[config.dictionary.pageNamePropertyName]=document.title;objProperties[config.dictionary.pageURLPropertyName]=window.location.pathname;this.track(config.dictionary.pageViewedEventName,objProperties)}}function trackLink(strSelector,strEventName,objProperties){mixpanel.track_links(strSelector,strEventName,objProperties)}function trackForm(strSelector,strEventName,objProperties){mixpanel.track_forms(strSelector,strEventName,objProperties)}function trackCharge(fltAmount,objProperties,fncCallback){mixpanel.people.track_charge(fltAmount,objProperties,fncCallback)}function registerEventsProperties(objProperties,intDays){mixpanel.register(objProperties,intDays)}function unregisterEventsProperties(strProperty){mixpanel.unregister(strProperty)}}).call(this,require("_process"))},{"../../config.js":1,_process:10}],9:[function(require,module,exports){var mpTracking=require("./mp-tracking"),mpPeople=require("./mp-people");module.exports={init:init,track:mpTracking.trackEvent,trackEvent:mpTracking.trackEvent,trackCharge:mpTracking.trackCharge,trackPageView:mpTracking.trackPageView,trackLink:mpTracking.trackLink,trackForm:mpTracking.trackForm,disableEvents:mpTracking.disableEvents,registerEventsProperties:mpTracking.registerEventsProperties,unregisterEventsProperties:mpTracking.unregisterEventsProperties,identifyUser:mpPeople.identifyUser,registerUserProperties:mpPeople.registerUserProperties};function init(strToken,objInitProperties){(function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);mixpanel.init(strToken,objInitProperties)}},{"./mp-people":7,"./mp-tracking":8}],10:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],11:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],12:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],13:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":11,"./encode":12}]},{},[3])(3)});
